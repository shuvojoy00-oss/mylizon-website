<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LizOn Education — IELTS Placement Test</title>

  <style>
    :root{
      --bg:#0f2e26;
      --bg2:#153b30;
      --card:rgba(255,255,255,.07);
      --card2:rgba(255,255,255,.10);
      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --line:rgba(255,255,255,.14);
      --accent:#b7ff8a;
      --warn:#ffdf6e;
      --danger:#ff8b8b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--txt);
      background: radial-gradient(1200px 900px at 30% 10%, var(--bg2), var(--bg));
      min-height:100vh;
    }
    .wrap{
      max-width:920px;
      margin:0 auto;
      padding:18px 14px 40px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 4px 16px;
    }
    .brand{
      display:flex; flex-direction:column; gap:2px;
    }
    .brand b{font-size:16px; letter-spacing:.2px}
    .brand small{color:var(--muted)}
    .pill{
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.12);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 12px 35px rgba(0,0,0,.22);
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:840px){
      .grid{grid-template-columns: 1.2fr .8fr;}
    }
    .progress{
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.10);
      overflow:hidden;
      border:1px solid var(--line);
    }
    .bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(183,255,138,.95), rgba(255,223,110,.95));
      transition: width .25s ease;
    }

    .stepTitle{
      font-size:18px;
      margin:2px 0 8px;
    }
    .hint{
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      margin:0 0 10px;
    }

    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin:12px 0 6px;
    }
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.14);
      color:var(--txt);
      outline:none;
    }
    textarea{min-height:140px; resize:vertical}
    input::placeholder, textarea::placeholder{color:rgba(255,255,255,.45)}
    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media(min-width:560px){
      .row{grid-template-columns: 1fr 1fr;}
    }

    .mcq{
      display:grid;
      gap:10px;
      margin:10px 0 0;
    }
    .q{
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
    }
    .q b{display:block; margin-bottom:8px; font-size:14px}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:8px 8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      margin:6px 0;
      cursor:pointer;
    }
    .opt input{width:auto; margin-top:2px}
    .opt span{color:rgba(255,255,255,.86); font-size:13px; line-height:1.3}
    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:14px;
    }
    button{
      border:none;
      border-radius:14px;
      padding:12px 14px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
    }
    .btn{
      background:rgba(183,255,138,.95);
      color:#0b1f19;
      flex:1;
      min-width:140px;
    }
    .ghost{
      background:transparent;
      border:1px solid var(--line);
      color:var(--txt);
      min-width:120px;
    }
    .mini{
      font-size:12px;
      padding:10px 12px;
      border-radius:12px;
    }
    .meta{
      display:flex; gap:10px; flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
    }
    .badge{
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.12);
    }
    .rightCard{
      position:sticky;
      top:12px;
    }
    .kpi{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    .kpi .box{
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
      border-radius:16px;
      padding:12px;
    }
    .kpi .box b{font-size:18px}
    .kpi .box small{display:block; color:var(--muted); margin-top:4px}
    .danger{color:var(--danger)}
    .warn{color:var(--warn)}
    .ok{color:var(--accent)}
    .muted{color:var(--muted)}
    .divider{height:1px; background:var(--line); margin:14px 0}
    .hidden{display:none}
    .toast{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
      opacity:.9;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <b>LizOn Education</b>
        <small>IELTS Placement Test (Hybrid)</small>
      </div>
      <div class="pill">Takes ~8–10 minutes • Mobile friendly</div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="progress" aria-label="progress"><div class="bar" id="bar"></div></div>

        <!-- Step 1 -->
        <section class="step" id="step1">
          <h2 class="stepTitle">Step 1 — Goal & Timeline</h2>
          <p class="hint">Answer honestly. This isn’t a quiz. It’s a diagnosis. We’ll suggest your best course path based on your target + time.</p>

          <div class="row">
            <div>
              <label>Full Name (required)</label>
              <input id="full_name" placeholder="Your name" />
            </div>
            <div>
              <label>WhatsApp Number (required)</label>
              <input id="phone" placeholder="01XXXXXXXXX" />
            </div>
          </div>

          <div class="row">
            <div>
              <label>Target IELTS Score (required)</label>
              <select id="target_score">
                <option value="">Select</option>
                <option>5.5</option>
                <option>6.0</option>
                <option>6.5</option>
                <option>7.0</option>
                <option>7.5+</option>
              </select>
            </div>
            <div>
              <label>Exam Timeline (required)</label>
              <select id="timeline">
                <option value="">Select</option>
                <option>2–4 weeks</option>
                <option>1–2 months</option>
                <option>2–3 months</option>
                <option>3+ months</option>
                <option>Not fixed</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Have you taken IELTS before? (required)</label>
              <select id="previous_attempt">
                <option value="">Select</option>
                <option>No</option>
                <option>Yes (once)</option>
                <option>Yes (2+ times)</option>
              </select>
            </div>
            <div>
              <label>If yes, last overall band</label>
              <select id="previous_band">
                <option value="">Select</option>
                <option>4.0–4.5</option>
                <option>5.0</option>
                <option>5.5</option>
                <option>6.0</option>
                <option>6.5</option>
                <option>7.0+</option>
              </select>
            </div>
          </div>

          <div class="actions">
            <button class="btn" onclick="nextStep(1)">Continue</button>
          </div>
          <div class="meta">
            <span class="badge">No long form</span>
            <span class="badge">One writing sample</span>
            <span class="badge">Instant suggestion</span>
          </div>
        </section>

        <!-- Step 2 -->
        <section class="step hidden" id="step2">
          <h2 class="stepTitle">Step 2 — Grammar Check (5 Questions)</h2>
          <p class="hint">Just pick the best option. This detects your grammar control, not memorization.</p>

          <div class="mcq" id="mcqWrap"></div>

          <div class="actions">
            <button class="ghost" onclick="prevStep(2)">Back</button>
            <button class="btn" onclick="nextStep(2)">Continue</button>
          </div>
        </section>

        <!-- Step 3 -->
        <section class="step hidden" id="step3">
          <h2 class="stepTitle">Step 3 — Writing Sample</h2>
          <p class="hint">Write 80–120 words. This shows structure + control. Don’t overthink. Just write like a real person.</p>

          <label>Prompt (write 80–120 words)</label>
          <div class="toast">
            <b>Why do you want to take IELTS and what is your plan for the next 2–3 months?</b>
          </div>

          <label>Your Answer (required)</label>
          <textarea id="writing_text" placeholder="Write here..."></textarea>
          <div class="meta">
            <span class="badge">Word count: <span id="wordCount">0</span></span>
            <span class="badge muted">Minimum 60 words (recommended 80–120)</span>
          </div>

          <label>Did you write this without Google Translate? (required)</label>
          <select id="used_translate">
            <option value="">Select</option>
            <option value="false">Yes (without Translate)</option>
            <option value="true">No (used Translate)</option>
          </select>

          <div class="actions">
            <button class="ghost" onclick="prevStep(3)">Back</button>
            <button class="btn" onclick="nextStep(3)">Continue</button>
          </div>
        </section>

        <!-- Step 4 -->
        <section class="step hidden" id="step4">
          <h2 class="stepTitle">Step 4 — Speaking Reality</h2>
          <p class="hint">No audio needed. Just be honest about comfort level.</p>

          <label>How comfortable are you speaking in English without preparation? (1–5)</label>
          <select id="speaking_level">
            <option value="">Select</option>
            <option value="1">1 (very weak)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (confident)</option>
          </select>

          <div class="actions">
            <button class="ghost" onclick="prevStep(4)">Back</button>
            <button class="btn" onclick="submitTest()">See Result</button>
          </div>
        </section>

        <!-- Result -->
        <section class="step hidden" id="result">
          <h2 class="stepTitle">Your IELTS Stage (Preview)</h2>
          <p class="hint">This is an instant suggestion. Our counselor will review your writing and confirm your final course path.</p>

          <div class="toast" id="resultBox"></div>

          <div class="actions">
            <button class="btn" id="waBtn">Confirm on WhatsApp</button>
            <button class="ghost" onclick="restart()">Restart</button>
          </div>

          <div class="meta" id="resultMeta"></div>
        </section>

      </div>

      <div class="card rightCard">
        <h3 style="margin:0 0 8px;font-size:16px;">How LizOn Uses This</h3>
        <p class="hint" style="margin-top:0;">
          We don’t guess. We diagnose. Your target score + timeline + writing sample tells us which course ladder you actually need.
        </p>

        <div class="divider"></div>

        <div class="kpi">
          <div class="box">
            <b class="ok">Fast</b>
            <small>No long test fatigue</small>
          </div>
          <div class="box">
            <b class="warn">Accurate</b>
            <small>Writing reveals structure</small>
          </div>
          <div class="box">
            <b class="danger">Honest</b>
            <small>No fake promises</small>
          </div>
          <div class="box">
            <b class="ok">Hybrid</b>
            <small>Auto + counselor confirm</small>
          </div>
        </div>

        <div class="divider"></div>

        <div class="toast">
          <b>Note:</b> In Bangladesh, IELTS is computer-based only. Your real score depends on structure + practice, not “random tips.”
        </div>

        <footer>© LizOn Education • MyLizOn.com</footer>
      </div>
    </div>
  </div>

<script>
  // ====== CONFIG ======
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyay8x00DXWbVXyWtY7jFJ8HI6ElE7BHSFeuHimjwgfO1UC4Ks3crWgr_its2AGopOsZQ/exec"; // <-- paste Apps Script Web App URL
  const LIZON_WA = "8801611611139"; // <-- your official WhatsApp number (no +)
  // ====================

  const steps = ["step1","step2","step3","step4","result"];
  let current = 1;

  const mcq = [
    {
      id:"g1",
      q:"Choose the correct sentence:",
      opts:[
        {k:"A",t:"She have finished her homework."},
        {k:"B",t:"She has finished her homework."}
      ],
      ans:"B"
    },
    {
      id:"g2",
      q:"Choose the correct sentence:",
      opts:[
        {k:"A",t:"I am living in Dhaka since 2020."},
        {k:"B",t:"I have been living in Dhaka since 2020."}
      ],
      ans:"B"
    },
    {
      id:"g3",
      q:"Pick the best connector: “I was tired, ____ I finished the task.”",
      opts:[
        {k:"A",t:"because"},
        {k:"B",t:"but"},
        {k:"C",t:"although"},
        {k:"D",t:"so"}
      ],
      ans:"D"
    },
    {
      id:"g4",
      q:"Identify the mistake: “Despite he was late, he joined the class.”",
      opts:[
        {k:"A",t:"Despite"},
        {k:"B",t:"he"},
        {k:"C",t:"was"},
        {k:"D",t:"joined"}
      ],
      ans:"B"
    },
    {
      id:"g5",
      q:"Choose correct preposition: “I’m interested ____ studying abroad.”",
      opts:[
        {k:"A",t:"on"},
        {k:"B",t:"in"},
        {k:"C",t:"at"},
        {k:"D",t:"for"}
      ],
      ans:"B"
    }
  ];

  // render MCQ
  const mcqWrap = document.getElementById("mcqWrap");
  mcqWrap.innerHTML = mcq.map((m,i)=>`
    <div class="q">
      <b>${i+1}. ${m.q}</b>
      ${m.opts.map(o=>`
        <label class="opt">
          <input type="radio" name="${m.id}" value="${o.k}">
          <span><b style="display:inline;font-size:13px">${o.k})</b> ${o.t}</span>
        </label>
      `).join("")}
    </div>
  `).join("");

  // word counter
  const wt = document.getElementById("writing_text");
  const wc = document.getElementById("wordCount");
  wt.addEventListener("input", ()=>{
    wc.textContent = countWords(wt.value);
  });

  function countWords(text){
    return (text || "").trim().split(/\s+/).filter(Boolean).length;
  }

  function setProgress(step){
    const percent = Math.round(((step-1) / 4) * 100);
    document.getElementById("bar").style.width = percent + "%";
  }
  setProgress(1);

  function show(id){
    steps.forEach(s=>document.getElementById(s).classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
  }

  function nextStep(n){
    if(n===1){
      if(!req("full_name") || !req("phone") || !req("target_score") || !req("timeline") || !req("previous_attempt")){
        alert("Please fill all required fields.");
        return;
      }
      current=2; setProgress(2); show("step2"); return;
    }
    if(n===2){
      // validate all mcq answered
      for(const m of mcq){
        const v = getRadio(m.id);
        if(!v){ alert("Please answer all 5 grammar questions."); return; }
      }
      current=3; setProgress(3); show("step3"); return;
    }
    if(n===3){
      const words = countWords(wt.value);
      if(words < 60){ alert("Please write at least 60 words."); return; }
      if(!req("used_translate")){ alert("Please select Translate option."); return; }
      current=4; setProgress(4); show("step4"); return;
    }
  }

  function prevStep(n){
    if(n===2){ current=1; setProgress(1); show("step1"); return; }
    if(n===3){ current=2; setProgress(2); show("step2"); return; }
    if(n===4){ current=3; setProgress(3); show("step3"); return; }
  }

  function req(id){
    const el = document.getElementById(id);
    return el && el.value && el.value.trim().length > 0;
  }

  function getRadio(name){
    const el = document.querySelector(`input[name="${name}"]:checked`);
    return el ? el.value : "";
  }

  function computeGrammarScore(){
    let score=0;
    for(const m of mcq){
      const v = getRadio(m.id);
      if(v === m.ans) score++;
    }
    return score;
  }

  function urgencyScore(timeline){
    if(timeline==="2–4 weeks") return 3;
    if(timeline==="1–2 months") return 2;
    if(timeline==="2–3 months") return 1;
    return 0;
  }

  function targetPressure(target){
    if(target==="7.5+" || target==="7.0") return 2;
    if(target==="6.5") return 1;
    return 0;
  }

  function speakingRisk(level){
    const n = parseInt(level,10);
    if(n<=2) return 2;
    if(n===3) return 1;
    return 0;
  }

  function decideStage(data){
    const g = data.grammar_score;
    const words = countWords(data.writing_text);
    const usedT = data.used_translate === true;

    // base stage from foundation signals
    let stage = "";

    if(g <= 2 || usedT || words < 60){
      stage = "FOUNDATION";
    } else if(g === 3){
      stage = "CORE SKILL FIX";
    } else {
      stage = "BAND 6+ TRACK";
    }

    // DESPERATE override if urgent + pressured + attempted
    const urg = urgencyScore(data.timeline);
    const press = targetPressure(data.target_score);
    const attempted = data.previous_attempt !== "No";
    if(urg >= 2 && (press >= 1 || attempted)){
      stage = "EXAM-KNOCKING";
    }

    return stage;
  }

  function recommendPath(stage){
    if(stage==="FOUNDATION") return "ZERO → HOPE";
    if(stage==="CORE SKILL FIX") return "HOPE";
    if(stage==="BAND 6+ TRACK") return "STEP-UP";
    if(stage==="EXAM-KNOCKING") return "DESPERATE";
    return "HOPE";
  }

  function makeResultId(){
    const d = new Date();
    const yy = String(d.getFullYear()).slice(2);
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const r = Math.floor(1000 + Math.random()*9000);
    return `LZPT-${yy}${mm}${dd}-${r}`;
  }

  function makeWhatsAppPrefill(data){
    const msg =
`Hi LizOn,
I completed the IELTS Placement Test.
Result ID: ${data.result_id}
Stage (preview): ${data.stage_auto}
Recommended path: ${data.recommended_path}
Target: ${data.target_score}
Timeline: ${data.timeline}
Please review my writing & confirm the final course.`;
    return msg;
  }

  async function submitTest(){
    if(!req("speaking_level")){
      alert("Please select speaking comfort level.");
      return;
    }

    const data = {
      result_id: makeResultId(),
      full_name: document.getElementById("full_name").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      target_score: document.getElementById("target_score").value,
      timeline: document.getElementById("timeline").value,
      previous_attempt: document.getElementById("previous_attempt").value,
      previous_band: document.getElementById("previous_band").value || "",
      grammar_score: computeGrammarScore(),
      speaking_level: parseInt(document.getElementById("speaking_level").value, 10),
      used_translate: (document.getElementById("used_translate").value === "true"),
      writing_text: document.getElementById("writing_text").value.trim(),
    };

    data.stage_auto = decideStage(data);
    data.recommended_path = recommendPath(data.stage_auto);

    const waMsg = makeWhatsAppPrefill(data);
    data.whatsapp_prefill = waMsg;

    // render result instantly (even if storage fails)
    renderResult(data);

    // store to Google Sheet
    try{
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(data)
      });
      const out = await res.json().catch(()=>({ok:false}));
      if(!out.ok){
        console.warn("Sheet write failed:", out);
        document.getElementById("resultMeta").insertAdjacentHTML("beforeend",
          `<span class="badge danger">Storage warning: could not save. Please WhatsApp us.</span>`
        );
      } else {
        document.getElementById("resultMeta").insertAdjacentHTML("beforeend",
          `<span class="badge ok">Saved ✔</span>`
        );
      }
    }catch(err){
      console.warn(err);
      document.getElementById("resultMeta").insertAdjacentHTML("beforeend",
        `<span class="badge danger">Result not saved automatically. Please confirm via WhatsApp.</span>`
      );
    }

    // final show
    setProgress(5);
    show("result");
  }

  function renderResult(data){
    const words = countWords(data.writing_text);
    const urg = urgencyScore(data.timeline);
    const press = targetPressure(data.target_score);
    const risk = speakingRisk(data.speaking_level);

    const stageLine = `<div style="font-size:15px;line-height:1.35">
      <b>Stage:</b> ${data.stage_auto}<br>
      <b>Recommended:</b> ${data.recommended_path}<br>
      <span class="muted">Result ID: <b>${data.result_id}</b></span>
    </div>`;

    const explain = `
      <div class="divider"></div>
      <div class="muted" style="font-size:13px;line-height:1.4">
        Grammar score: <b>${data.grammar_score}/5</b> • Writing words: <b>${words}</b> • Timeline urgency: <b>${urg}</b> • Target pressure: <b>${press}</b> • Speaking risk: <b>${risk}</b><br>
        <span class="warn">Counselor will review your writing</span> and confirm your final path.
      </div>
    `;

    document.getElementById("resultBox").innerHTML =
      stageLine + explain +
      `<div class="divider"></div>
       <div style="font-size:13px;line-height:1.4">
         <b>Rule:</b> Random practice e stable improvement hoy na. Structure fix first, then strategy.
       </div>`;

    // WhatsApp button
    const wa = document.getElementById("waBtn");
    const waText = encodeURIComponent(data.whatsapp_prefill);
    wa.onclick = ()=> {
      window.location.href = `https://wa.me/${LIZON_WA}?text=${waText}`;
    };

    // meta badges
    const meta = document.getElementById("resultMeta");
    meta.innerHTML = `
      <span class="badge">Grammar: ${data.grammar_score}/5</span>
      <span class="badge">Target: ${data.target_score}</span>
      <span class="badge">Timeline: ${data.timeline}</span>
      <span class="badge">Speaking: ${data.speaking_level}/5</span>
    `;
  }

  function restart(){
    window.scrollTo({top:0, behavior:"smooth"});
    location.reload();
  }
</script>
</body>
</html>
