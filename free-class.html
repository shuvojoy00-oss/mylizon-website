<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LizOn Education — Live Free Class</title>

  <style>
    :root{
      /* LizOn vibe (Dark Green primary) */
      --bg: #0f1714;
      --card: #141f1b;
      --muted: #9fb3aa;
      --text: #e9f3ee;
      --brand: #0f5f3f;   /* dark green */
      --brand2:#0b3f2b;
      --line: rgba(255,255,255,.10);
      --warn:#ffda6a;

      --shadow: 0 12px 28px rgba(0,0,0,.35);
      --radius: 18px;
    }

    /* Light mode (optional) */
    [data-theme="light"]{
      --bg:#f6fbf8;
      --card:#ffffff;
      --muted:#476056;
      --text:#0e1713;
      --brand:#0f5f3f;
      --brand2:#0b3f2b;
      --line: rgba(0,0,0,.10);
      --shadow: 0 10px 24px rgba(0,0,0,.08);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color: var(--text);
    }

    .wrap{max-width:1100px; margin:0 auto; padding:18px 16px 42px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:10px 2px 14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.2px;
    }
    .pill{
      font-size:12px; padding:6px 10px; border:1px solid var(--line);
      border-radius:999px; color:var(--muted);
      background: rgba(255,255,255,.03);
    }
    .toggle{
      border:1px solid var(--line);
      background: transparent; color:var(--text);
      border-radius:999px; padding:8px 12px; cursor:pointer;
    }

    .hero{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(15,95,63,.22), rgba(255,255,255,.02));
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .announce{
      border:1px solid rgba(255,218,106,.35);
      background: rgba(255,218,106,.10);
      border-radius: 14px;
      padding:12px 12px;
      display:flex; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      gap:10px;
    }
    .announce b{font-size:14px}
    .announce span{color: var(--muted); font-size:13px}

    .grid{
      display:grid;
      grid-template-columns: 1.4fr .6fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr;}
    }

    .card{
      border:1px solid var(--line);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHead{
      padding:14px 14px 10px;
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:12px;
      border-bottom:1px solid var(--line);
    }
    .cardHead h2{
      margin:0; font-size:16px;
    }
    .meta{
      margin-top:6px; color:var(--muted); font-size:13px; line-height:1.35;
    }

    .frameWrap{
      position:relative;
      width:100%;
      aspect-ratio: 16/9;
      background: rgba(0,0,0,.18);
    }
    iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }

    .fallback{
      padding:14px;
      display:none;
    }
    .btnRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;}
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid var(--line);
      text-decoration:none;
      color: var(--text);
      background: rgba(255,255,255,.03);
      font-weight:700;
      gap:8px;
    }
    .btn.primary{
      background: linear-gradient(180deg, var(--brand), var(--brand2));
      border-color: rgba(255,255,255,.14);
    }
    .btn.small{padding:10px 12px; font-size:13px; font-weight:700}
    .btn:hover{filter: brightness(1.05);}

    .side{
      padding:14px;
    }
    .side h3{margin:0 0 8px; font-size:14px}
    .list{display:flex; flex-direction:column; gap:10px; margin-top:10px;}
    .item{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      background: rgba(255,255,255,.02);
    }
    .item b{display:block; font-size:13px}
    .item span{display:block; margin-top:6px; font-size:13px; color:var(--muted); line-height:1.35}
    .quote{
      font-style: italic;
    }

    .footerLinks{
      display:flex; flex-wrap:wrap; gap:10px;
      padding:14px;
      border-top:1px solid var(--line);
    }

    .tiny{
      font-size:12px; color:var(--muted);
      padding:10px 2px 0;
    }
  </style>
</head>

<body data-theme="dark">
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div>LizOn Education</div>
        <div class="pill" id="badge">Live Free Class</div>
      </div>
      <button class="toggle" id="themeBtn">Toggle theme</button>
    </div>

    <div class="hero">
      <div class="announce">
        <div>
          <b id="announcementTitle">Announcement</b><br/>
          <span id="announcementText">Loading...</span>
        </div>
        <div class="pill" id="nextClassPill">Next class: —</div>
      </div>

      <div class="grid">
        <!-- Main video/card -->
        <div class="card">
          <div class="cardHead">
            <div>
              <h2 id="classTitle">Today’s Live Class</h2>
              <div class="meta" id="classMeta">Loading class info…</div>
            </div>
            <a class="btn small primary" id="joinBtnTop" href="#" target="_blank" rel="noopener">Join Class</a>
          </div>

          <div class="frameWrap" id="frameWrap">
            <iframe id="classFrame" allow="camera; microphone; fullscreen; display-capture"></iframe>
          </div>

          <div class="fallback" id="fallback">
            <div class="meta">
              Some platforms don’t allow embedding inside a website (security restriction).
              No problem — use the button below.
            </div>
            <div class="btnRow">
              <a class="btn primary" id="joinBtn" href="#" target="_blank" rel="noopener">Join Class</a>
              <a class="btn" id="recordingsBtn" href="#" target="_blank" rel="noopener">Watch Recordings</a>
            </div>
          </div>

          <div class="footerLinks">
            <a class="btn small" id="homeLink" href="/">Home</a>
            <a class="btn small" id="ieltsLink" href="/ielts.html">Explore IELTS</a>
            <a class="btn small" id="pteLink" href="/pte.html">Explore PTE</a>
            <a class="btn small" id="oneOnOneLink" href="/routine.html">1-on-1 / Routine</a>
          </div>
        </div>

        <!-- Side panel -->
        <div class="card">
          <div class="side">
            <h3>What you can do here</h3>
            <div class="list">
              <div class="item">
                <b>1) Join the class</b>
                <span>Use the embedded class (if supported) or tap “Join Class”.</span>
              </div>
              <div class="item">
                <b>2) Watch previous classes</b>
                <span>Open recordings and revise anytime.</span>
              </div>
              <div class="item">
                <b>3) Explore courses</b>
                <span>IELTS / PTE / routines — everything stays one click away.</span>
              </div>
            </div>

            <h3 style="margin-top:14px;">Motivation</h3>
            <div class="list" id="quotesList"></div>

            <div class="tiny">
              Tip: Save this page as a bookmark so you never lose the class link.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tiny" id="updatedAt"></div>
  </div>

  <script>
    const THEME_KEY = "lizon_theme";
    const themeBtn = document.getElementById("themeBtn");
    const root = document.body;

    function setTheme(t){
      root.setAttribute("data-theme", t);
      localStorage.setItem(THEME_KEY, t);
    }
    setTheme(localStorage.getItem(THEME_KEY) || "dark");
    themeBtn.addEventListener("click", () => {
      const cur = root.getAttribute("data-theme");
      setTheme(cur === "dark" ? "light" : "dark");
    });

    const els = {
      announcementTitle: document.getElementById("announcementTitle"),
      announcementText: document.getElementById("announcementText"),
      nextClassPill: document.getElementById("nextClassPill"),
      classTitle: document.getElementById("classTitle"),
      classMeta: document.getElementById("classMeta"),
      classFrame: document.getElementById("classFrame"),
      frameWrap: document.getElementById("frameWrap"),
      fallback: document.getElementById("fallback"),
      joinBtn: document.getElementById("joinBtn"),
      joinBtnTop: document.getElementById("joinBtnTop"),
      recordingsBtn: document.getElementById("recordingsBtn"),
      homeLink: document.getElementById("homeLink"),
      ieltsLink: document.getElementById("ieltsLink"),
      pteLink: document.getElementById("pteLink"),
      oneOnOneLink: document.getElementById("oneOnOneLink"),
      quotesList: document.getElementById("quotesList"),
      updatedAt: document.getElementById("updatedAt"),
    };

    function safeText(x){ return (x ?? "").toString(); }

    async function loadConfig(){
      const res = await fetch("/data/freeclass.json", { cache: "no-store" });
      if(!res.ok) throw new Error("Config load failed");
      return await res.json();
    }

    function renderQuotes(quotes){
      els.quotesList.innerHTML = "";
      (quotes || []).slice(0,6).forEach(q => {
        const div = document.createElement("div");
        div.className = "item quote";
        div.textContent = "“" + q + "”";
        els.quotesList.appendChild(div);
      });
    }

    function showFallback(joinUrl, recordingsUrl){
      els.frameWrap.style.display = "none";
      els.fallback.style.display = "block";
      els.joinBtn.href = joinUrl || "#";
      els.joinBtnTop.href = joinUrl || "#";
      els.recordingsBtn.href = recordingsUrl || "#";
    }

    function showEmbed(embedUrl, joinUrl){
      els.frameWrap.style.display = "block";
      els.fallback.style.display = "none";
      els.classFrame.src = embedUrl;
      els.joinBtnTop.href = joinUrl || embedUrl || "#";
    }

    (async function init(){
      try{
        const cfg = await loadConfig();

        els.announcementTitle.textContent = safeText(cfg.announcement?.title || "Announcement");
        els.announcementText.textContent  = safeText(cfg.announcement?.text || "");
        els.nextClassPill.textContent     = "Next class: " + safeText(cfg.next_class?.when || "—");

        els.classTitle.textContent = safeText(cfg.class?.title || "Live Free Class");
        els.classMeta.textContent  = safeText(cfg.class?.subtitle || "");

        // Links
        if(cfg.links?.home) els.homeLink.href = cfg.links.home;
        if(cfg.links?.ielts) els.ieltsLink.href = cfg.links.ielts;
        if(cfg.links?.pte) els.pteLink.href = cfg.links.pte;
        if(cfg.links?.one_on_one) els.oneOnOneLink.href = cfg.links.one_on_one;

        const joinUrl = cfg.class?.join_url || "";
        const embedUrl = cfg.class?.embed_url || "";
        const recordingsUrl = cfg.class?.recordings_url || "";

        els.recordingsBtn.href = recordingsUrl || "#";

        // Render quotes
        renderQuotes(cfg.quotes);

        // Decide embed vs fallback:
        // - If embed_url exists: try embed
        // - Otherwise fallback (button)
        if(embedUrl){
          showEmbed(embedUrl, joinUrl);
          // If embedding fails (blocked by X-Frame-Options), show fallback automatically
          const t = setTimeout(() => showFallback(joinUrl, recordingsUrl), 3500);
          els.classFrame.addEventListener("load", () => clearTimeout(t));
        } else {
          showFallback(joinUrl, recordingsUrl);
        }

        els.updatedAt.textContent = "Last updated: " + safeText(cfg.updated_at || "");
      }catch(e){
        els.announcementText.textContent = "Config not found. Create /data/freeclass.json";
        els.classMeta.textContent = "Setup required.";
        showFallback("#", "#");
      }
    })();
  </script>
</body>
</html>